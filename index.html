<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Euro Payment Form</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Load Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
                body {
            color: transparent;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        body > * {
            margin-top: 50px; /* pushes everything down */
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.85);
            z-index: -1;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #6772e5 0%, #5469d4 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo i {
            font-size: 22px;
            color: #6772e5;
        }
        
        .header-content {
            text-align: center;
        }
        
        .header-content h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .header-content p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .payment-body {
            padding: 30px;
        }
        
        .section-title {
            font-size: 18px;
            color: #6772e5;
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f6f9fc;
            display: flex;
            align-items: center;
        }
        
        .section-title:first-child {
            margin-top: 0;
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        .donation-type {
            display: flex;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #e6ebf1;
            backdrop-filter: blur(5px);
        }
        
        .donation-option {
            flex: 1;
            text-align: center;
            padding: 14px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #525f7f;
            background: transparent;
        }
        
        .donation-option.active {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        #one-time-option.active {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            border: 2px solid #ff9a9e;
        }
        
        #monthly-option.active {
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            border: 2px solid #a18cd1;
        }
        
        .donation-option:not(.active):hover {
            background: rgba(103, 114, 229, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: #525f7f;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 1px solid #cfd7df;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #6772e5;
            box-shadow: 0 0 0 3px rgba(103, 114, 229, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .card-element-container {
            padding: 14px;
            border: 1px solid #cfd7df;
            border-radius: 8px;
            transition: all 0.2s ease;
            background: #f8f9fa;
        }
        
        .StripeElement {
            padding: 10px 12px;
        }
        
        .StripeElement--focus {
            box-shadow: 0 0 0 3px rgba(103, 114, 229, 0.2);
            border-color: #6772e5;
        }
        
        .StripeElement--invalid {
            border-color: #e25950;
        }
        
        .StripeElement--complete {
            border-color: #24b47e;
        }
        
        .pay-button {
            background: linear-gradient(135deg, #6772e5 0%, #5469d4 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(103, 114, 229, 0.3);
            margin-top: 10px;
        }
        
        .pay-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(103, 114, 229, 0.4);
        }
        
        .pay-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .secure-notice {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            color: #6b7c93;
            font-size: 14px;
        }
        
        .secure-notice i {
            margin-right: 8px;
            color: #24b47e;
        }
        
        .accepted-cards {
            margin-top: 25px;
            text-align: center;
        }
        
        .accepted-cards p {
            font-size: 14px;
            color: #6b7c93;
            margin-bottom: 10px;
        }
        
        .card-icons {
            display: flex;
            justify-content: center;
            gap: 12px;
        }
        
        .card-icons i {
            font-size: 32px;
            color: #6772e5;
        }
        
        .payment-footer {
            background: #f6f9fc;
            padding: 20px 30px;
            text-align: center;
            border-top: 1px solid #e6ebf1;
        }
        
        .payment-footer p {
            font-size: 14px;
            color: #6b7c93;
        }
        
        .other-amount-container {
            display: none;
            margin-top: 15px;
            animation: fadeIn 0.5s ease;
        }
        
        .other-amount-container.visible {
            display: block;
        }
        
        .currency-symbol {
            position: relative;
        }
        
        .currency-symbol::before {
            content: "€";
            position: absolute;
            left: 10px;
            top: 14px;
            color: #6772e5;
            font-weight: bold;
            z-index: 1;
        }
        
        .currency-symbol input {
            padding-left: 30px;
        }
        
        .card-errors {
            color: #e25950;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }
        
        .card-errors.visible {
            display: block;
        }
        
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .processing-spinner {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        
        .processing-spinner i {
            font-size: 40px;
            color: #6772e5;
            margin-bottom: 15px;
        }
        
        /* Success/Failure Pages */
        .status-container {
            display: none;
            text-align: center;
            padding: 40px 30px;
        }
        
        .status-icon {
            font-size: 70px;
            margin-bottom: 25px;
        }
        
        .success-icon {
            color: #24b47e;
        }
        
        .failure-icon {
            color: #e25950;
        }
        
        .status-title {
            font-size: 28px;
            margin-bottom: 15px;
            color: #32325d;
        }
        
        .status-message {
            font-size: 18px;
            color: #525f7f;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .status-details {
            background: #f6f9fc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: left;
        }
        
        .status-details h3 {
            margin-bottom: 15px;
            color: #6772e5;
        }
        
        .detail-item {
            display: flex;
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            min-width: 120px;
            color: #525f7f;
        }
        
        .back-button {
            background: linear-gradient(135deg, #6772e5 0%, #5469d4 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(103, 114, 229, 0.3);
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(103, 114, 229, 0.4);
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .form-row .form-group {
                margin-bottom: 20px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }
            
            .logo {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .payment-body {
                padding: 20px;
            }
            
            .donation-type {
                flex-direction: column;
            }
            
            .donation-option {
                margin-bottom: 5px;
            }
            
            .detail-item {
                flex-direction: column;
                margin-bottom: 15px;
            }
            
            .detail-label {
                margin-bottom: 5px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 15px;
            }
            
            .header-content h1 {
                font-size: 20px;
            }
            
            .header-content p {
                font-size: 13px;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            input, select {
                padding: 12px;
            }
            
            .pay-button {
                padding: 14px;
                font-size: 15px;
            }
            
            .status-title {
                font-size: 24px;
            }
            
            .status-message {
                font-size: 16px;
            }
        }
        
        /* Animation for better UX */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            animation: fadeIn 0.5s ease-out;
            animation-fill-mode: both;
        }
        
        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-row { animation-delay: 0.4s; }
        .pay-button { animation-delay: 0.5s; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Payment Form -->
        <div id="payment-form">
            <div class="header">
                <div class="logo">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="header-content">
                    <h1>Secure Payment</h1>
                    <p>Complete your payment with our secure checkout</p>
                </div>
            </div>
            
            <div class="payment-body">
                <div class="section-title">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Payment Type</span>
                </div>
                
                <div class="donation-type">
                    <div class="donation-option active" id="one-time-option">One-Time Payment</div>
                    <div class="donation-option" id="monthly-option">Monthly Subscription</div>
                </div>
                
                <div class="section-title">
                    <i class="fas fa-user"></i>
                    <span>Personal Information</span>
                </div>
                
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="John Smith">
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="your.email@example.com">
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number (Optional)</label>
                    <input type="tel" id="phone" placeholder="(123) 456-7890">
                </div>
                
                <div class="section-title">
                    <i class="fas fa-address-card"></i>
                    <span>Billing Address</span>
                </div>
                
                <div class="form-group">
                    <label for="line1">Street Address</label>
                    <input type="text" id="line1" placeholder="123 Main St">
                </div>
                
                <div class="form-group">
                    <label for="line2">Apt, Suite, Building (Optional)</label>
                    <input type="text" id="line2" placeholder="Apt 456">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" id="city" placeholder="Paris">
                    </div>
                    
                    <div class="form-group">
                        <label for="state">State/Province</label>
                        <input type="text" id="state" placeholder="Île-de-France">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="postal_code">Postal Code</label>
                        <input type="text" id="postal_code" placeholder="75001">
                    </div>
                    
                    <div class="form-group">
                        <label for="country">Country</label>
                        <select id="country">
                            <option value="">Select country</option>
                            <option value="FR" selected>France</option>
                            <option value="DE">Germany</option>
                            <option value="IT">Italy</option>
                            <option value="ES">Spain</option>
                            <option value="NL">Netherlands</option>
                            <option value="BE">Belgium</option>
                            <option value="PT">Portugal</option>
                            <option value="IE">Ireland</option>
                            <option value="AT">Austria</option>
                            <option value="GR">Greece</option>
                        </select>
                    </div>
                </div>
                
                <div class="section-title">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Information</span>
                </div>
                
                <div class="form-group">
                    <label for="amount">Payment Amount (EUR)</label>
                    <select id="amount">
                        <option value="25">€25</option>
                        <option value="50">€50</option>
                        <option value="100" selected>€100</option>
                        <option value="250">€250</option>
                        <option value="500">€500</option>
                        <option value="other">Other amount</option>
                    </select>
                </div>
                
                <div class="other-amount-container" id="other-amount-container">
                    <div class="form-group currency-symbol">
                        <label for="custom-amount">Enter Custom Amount (€)</label>
                        <input type="number" id="custom-amount" placeholder="Enter amount" min="1" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="card-element">Card Details</label>
                    <div class="card-element-container" id="card-element">
                        <!-- Stripe Elements will be inserted here -->
                    </div>
                    <div class="card-errors" id="card-errors" role="alert"></div>
                </div>
                
                <div class="form-group">
                    <label for="card-name">Name on Card</label>
                    <input type="text" id="card-name" placeholder="John Smith">
                </div>
                
                <button class="pay-button" id="submit-button">Pay €100.00</button>
                
                <div class="secure-notice">
                    <i class="fas fa-lock"></i>
                    <span>Your payment is secured with SSL encryption</span>
                </div>
                
                <div class="accepted-cards">
                    <p>We accept</p>
                    <div class="card-icons">
                        <i class="fa-brands fa-cc-visa"></i>
                        <i class="fa-brands fa-cc-mastercard"></i>
                        <i class="fa-brands fa-cc-amex"></i>
                        <i class="fa-brands fa-cc-discover"></i>
                    </div>
                </div>
            </div>
            
            <div class="payment-footer">
                <p>Need help? Contact <a href="mailto:contact@newmayapur.com">contact@newmayapur.com</a></p>
            </div>
        </div>
        
        <!-- Success Page -->
        <div class="status-container" id="success-page">
            <div class="status-icon">
                <i class="fas fa-check-circle success-icon"></i>
            </div>
            <h2 class="status-title">Payment Successful!</h2>
            <p class="status-message">Thank you for your payment. A confirmation email has been sent to your email address.</p>
            
            <div class="status-details">
                <h3>Payment Details</h3>
                <div class="detail-item">
                    <span class="detail-label">Amount:</span>
                    <span id="success-amount"></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Transaction ID:</span>
                    <span id="success-transaction"></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Date:</span>
                    <span id="success-date"></span>
                </div>
            </div>
            
            <button class="back-button" id="success-back-button">Return to Payment Form</button>
        </div>
        
        <!-- Failure Page -->
        <div class="status-container" id="failure-page">
            <div class="status-icon">
                <i class="fas fa-times-circle failure-icon"></i>
            </div>
            <h2 class="status-title">Payment Failed</h2>
            <p class="status-message" id="failure-message">We're sorry, but your payment could not be processed.</p>
            
            <div class="status-details">
                <h3>Error Details</h3>
                <div class="detail-item">
                    <span class="detail-label">Amount:</span>
                    <span id="failure-amount"></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Error Code:</span>
                    <span id="failure-code"></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Message:</span>
                    <span id="failure-message-detail"></span>
                </div>
            </div>
            
            <button class="back-button" id="failure-back-button">Try Again</button>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processing-overlay">
        <div class="processing-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Processing your payment...</p>
        </div>
    </div>

    <script>
        // Initialize Stripe with your publishable key
        // IMPORTANT: Replace with your actual publishable key from Stripe dashboard
        const stripe = Stripe('pk_test_51S1OAH3pBglTeA0mBud6ByC3NIv6nMTrQ4ITBQ1h1GDTBX5ygMuoeCVeBZdF1Jy5wmQq819Xbd4kKRjZ3aJJcDfu00dGiF5MC6');
        const elements = stripe.elements();
        
        // Custom styling for the Stripe Elements
        const style = {
            base: {
                color: '#32325d',
                fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
                fontSmoothing: 'antialiased',
                fontSize: '16px',
                '::placeholder': {
                    color: '#aab7c4'
                }
            },
            invalid: {
                color: '#e25950',
                iconColor: '#e25950'
            }
        };
        
        // Create an instance of the card Element
        const card = elements.create('card', {
            style: style,
            hidePostalCode: true
        });
        
        // Add an instance of the card Element into the `card-element` div
        card.mount('#card-element');
        
        // Handle real-time validation errors from the card Element
        card.addEventListener('change', function(event) {
            const displayError = document.getElementById('card-errors');
            if (event.error) {
                displayError.textContent = event.error.message;
                displayError.classList.add('visible');
            } else {
                displayError.textContent = '';
                displayError.classList.remove('visible');
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            const paymentForm = document.getElementById('payment-form');
            const successPage = document.getElementById('success-page');
            const failurePage = document.getElementById('failure-page');
            const payButton = document.getElementById('submit-button');
            const amountSelect = document.getElementById('amount');
            const oneTimeOption = document.getElementById('one-time-option');
            const monthlyOption = document.getElementById('monthly-option');
            const otherAmountContainer = document.getElementById('other-amount-container');
            const customAmountInput = document.getElementById('custom-amount');
            const cardErrors = document.getElementById('card-errors');
            const processingOverlay = document.getElementById('processing-overlay');
            const successBackButton = document.getElementById('success-back-button');
            const failureBackButton = document.getElementById('failure-back-button');
            
            // Toggle other amount field
            amountSelect.addEventListener('change', function() {
                if (this.value === 'other') {
                    otherAmountContainer.classList.add('visible');
                    updateButtonText();
                } else {
                    otherAmountContainer.classList.remove('visible');
                    updateButtonText();
                }
            });
            
            // Update custom amount field
            customAmountInput.addEventListener('input', function() {
                updateButtonText();
            });
            
            // Toggle between one-time and monthly payment
            oneTimeOption.addEventListener('click', function() {
                oneTimeOption.classList.add('active');
                monthlyOption.classList.remove('active');
                updateButtonText();
            });
            
            monthlyOption.addEventListener('click', function() {
                monthlyOption.classList.add('active');
                oneTimeOption.classList.remove('active');
                updateButtonText();
            });
            
            // Back buttons
            successBackButton.addEventListener('click', function() {
                successPage.style.display = 'none';
                paymentForm.style.display = 'block';
            });
            
            failureBackButton.addEventListener('click', function() {
                failurePage.style.display = 'none';
                paymentForm.style.display = 'block';
            });
            
            function updateButtonText() {
                const isMonthly = monthlyOption.classList.contains('active');
                const amount = amountSelect.value;
                
                if (amount === 'other') {
                    const customAmount = customAmountInput.value;
                    if (customAmount) {
                        const frequency = isMonthly ? '/month' : '';
                        payButton.textContent = isMonthly ? 
                            `Subscribe €${customAmount}${frequency}` : 
                            `Pay €${customAmount}`;
                    } else {
                        payButton.textContent = isMonthly ? 
                            'Enter monthly amount' : 
                            'Enter custom amount';
                    }
                } else {
                    const frequency = isMonthly ? '/month' : '';
                    payButton.textContent = isMonthly ? 
                        `Subscribe €${amount}${frequency}` : 
                        `Pay €${amount}.00`;
                }
            }
            
            // Payment form submission
            payButton.addEventListener('click', async function(e) {
                e.preventDefault();
                
                // Reset errors
                cardErrors.textContent = '';
                cardErrors.classList.remove('visible');
                
                // Validate required fields
                const requiredFields = ['name', 'email', 'line1', 'city', 'postal_code', 'country', 'card-name'];
                let isValid = true;
                
                // If other amount is selected, validate it
                if (amountSelect.value === 'other' && !customAmountInput.value) {
                    customAmountInput.style.borderColor = '#e25950';
                    isValid = false;
                } else {
                    customAmountInput.style.borderColor = '#cfd7df';
                }
                
                requiredFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (!element.value.trim()) {
                        element.style.borderColor = '#e25950';
                        isValid = false;
                    } else {
                        element.style.borderColor = '#cfd7df';
                    }
                });
                
                if (!isValid) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Get the payment amount
                let paymentAmount;
                if (amountSelect.value === 'other') {
                    paymentAmount = Math.round(parseFloat(customAmountInput.value) * 100); // Convert to cents
                } else {
                    paymentAmount = parseInt(amountSelect.value) * 100; // Convert to cents
                }
                
                // Validate payment amount
                if (isNaN(paymentAmount) || paymentAmount < 50) { // Minimum amount of €0.50
                    alert('Please enter a valid payment amount (minimum €0.50)');
                    return;
                }
                
                // Show processing state
                const originalText = payButton.textContent;
                const isMonthly = monthlyOption.classList.contains('active');
                payButton.disabled = true;
                processingOverlay.style.display = 'flex';
                
                try {
                    // First, create a payment intent on our server
                    const response = await fetch('/.netlify/functions/create-payment-intent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            amount: paymentAmount,
                            currency: 'eur',
                            isMonthly: isMonthly
                        }),
                    });
                    
                    const { clientSecret, error: serverError } = await response.json();
                    
                    if (serverError) {
                        throw new Error(serverError);
                    }
                    
                    // Confirm the payment with the card details
                    const { error: confirmError, paymentIntent } = await stripe.confirmCardPayment(
                        clientSecret,
                        {
                            payment_method: {
                                card: card,
                                billing_details: {
                                    name: document.getElementById('card-name').value,
                                    email: document.getElementById('email').value,
                                    phone: document.getElementById('phone').value,
                                    address: {
                                        line1: document.getElementById('line1').value,
                                        line2: document.getElementById('line2').value,
                                        city: document.getElementById('city').value,
                                        state: document.getElementById('state').value,
                                        postal_code: document.getElementById('postal_code').value,
                                        country: document.getElementById('country').value,
                                    }
                                }
                            }
                        }
                    );
                    
                    if (confirmError) {
                        // Show error to customer
                        showPaymentStatus('failure', `€${(paymentAmount/100).toFixed(2)}`, confirmError.type, confirmError.message);
                        return;
                    }
                    
                    // Payment succeeded
                    showPaymentStatus('success', `€${(paymentAmount/100).toFixed(2)}`, paymentIntent.id);
                    
                    // Reset form
                    document.querySelectorAll('input').forEach(input => input.value = '');
                    document.getElementById('country').value = 'FR';
                    document.getElementById('amount').value = '100';
                    otherAmountContainer.classList.remove('visible');
                    card.clear();
                    
                } catch (err) {
                    console.error('Error:', err);
                    showPaymentStatus('failure', `€${(paymentAmount/100).toFixed(2)}`, 'server_error', err.message);
                } finally {
                    payButton.textContent = originalText;
                    payButton.disabled = false;
                    processingOverlay.style.display = 'none';
                }
            });
            
            // Function to show payment status
            function showPaymentStatus(status, amount, code = null, message = null) {
                // Hide payment form
                paymentForm.style.display = 'none';
                
                if (status === 'success') {
                    // Show success details
                    document.getElementById('success-amount').textContent = amount;
                    document.getElementById('success-transaction').textContent = code || 'N/A';
                    document.getElementById('success-date').textContent = new Date().toLocaleString();
                    
                    // Show success page
                    successPage.style.display = 'block';
                    failurePage.style.display = 'none';
                } else {
                    // Show failure details
                    document.getElementById('failure-amount').textContent = amount;
                    document.getElementById('failure-code').textContent = code || 'Unknown error';
                    document.getElementById('failure-message-detail').textContent = message || 'Please try again later';
                    
                    // Show failure page
                    failurePage.style.display = 'block';
                    successPage.style.display = 'none';
                }
            }
            
            // Add input validation
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value.trim() !== '') {
                        this.style.borderColor = '#24b47e';
                    } else {
                        this.style.borderColor = '#cfd7df';
                    }
                });
            });
        });
    </script>
</body>
</html>






